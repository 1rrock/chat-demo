# WebSocket Chat Demo

NestJS + Socket.IO μ„λ²„μ™€ React ν΄λΌμ΄μ–ΈνΈλ¥Ό μ‚¬μ©ν• μ±„ν… μ• ν”λ¦¬μΌ€μ΄μ…μ…λ‹λ‹¤.

## ν”„λ΅μ νΈ κµ¬μ΅°
```
ws-demo/
  server/   # NestJS μ„λ²„
  client/   # React ν΄λΌμ΄μ–ΈνΈ (Vite)
  docker-compose.yml  # Docker λ°°ν¬ μ„¤μ •
```

## π€ Dockerλ΅ λ°°ν¬ν•κΈ° (μ™Έλ¶€ λ„¤νΈμ›ν¬ μ ‘κ·Ό κ°€λ¥)

### λΉ λ¥Έ μ‹μ‘
```bash
# ν”„λ΅μ νΈ λ£¨νΈμ—μ„ μ‹¤ν–‰
docker-compose up -d --build
```

### μ ‘μ† λ°©λ²•
- **ν΄λΌμ΄μ–ΈνΈ**: http://μ„λ²„IP (ν¬νΈ 80)
- **μ„λ²„ API**: http://μ„λ²„IP:3000

### Docker λ…λ Ήμ–΄
```bash
# λΉλ“ λ° μ‹¤ν–‰
docker-compose up -d --build

# λ΅κ·Έ ν™•μΈ
docker-compose logs -f

# μ„λΉ„μ¤ μ¤‘μ§€
docker-compose down

# μ΄λ―Έμ§€ λ‹¤μ‹ λΉλ“
docker-compose build --no-cache
```

## π›  κ°λ° ν™κ²½ μ‹¤ν–‰ λ°©λ²•

### 1. μ„λ²„ μ‹¤ν–‰
```bash
cd server
npm install
npm run start:dev
```
μ„λ²„κ°€ http://localhost:3000 μ—μ„ μ‹¤ν–‰λ©λ‹λ‹¤.

### 2. ν΄λΌμ΄μ–ΈνΈ μ‹¤ν–‰ (μƒ ν„°λ―Έλ„)
```bash
cd client
npm install
npm run dev
```
ν΄λΌμ΄μ–ΈνΈκ°€ http://localhost:5173 μ—μ„ μ‹¤ν–‰λ©λ‹λ‹¤.

## π”§ ν™κ²½ λ³€μ μ„¤μ •

### ν΄λΌμ΄μ–ΈνΈ ν™κ²½ λ³€μ (.env)
```env
VITE_SERVER_URL=https://your-server-url.com
```

### μ„λ²„ ν™κ²½ λ³€μ
```env
PORT=3000
NODE_ENV=production
```

## π μ™Έλ¶€ μ ‘κ·Ό μ„¤μ •

### ν΄λΌμ°λ“ λ°°ν¬μ νΉμ§•:
1. **μλ™ HTTPS**: λ€λ¶€λ¶„μ ν΄λΌμ°λ“ ν”λ«νΌμ—μ„ μλ™ SSL μ κ³µ
2. **κΈ€λ΅λ² CDN**: μ „μ„Έκ³„ μ–΄λ””μ„λ‚ λΉ λ¥Έ μ ‘μ†
  docker-compose.yml      # λ΅μ»¬ Docker λ°°ν¬
  render.yaml            # Render λ°°ν¬ μ„¤μ •
### Docker λ°°ν¬μ νΉμ§•:
1. **ν¬νΈ λ§¤ν•‘**: ν΄λΌμ΄μ–ΈνΈ(80), μ„λ²„(3000)
2. **μλ™ ν™κ²½ κ°μ§€**: ν”„λ΅λ•μ… ν™κ²½μ—μ„ μλ™μΌλ΅ μ¬λ°”λ¥Έ μ„λ²„ URL μ‚¬μ©
3. **CORS μ„¤μ •**: λ¨λ“  originμ—μ„ μ ‘κ·Ό κ°€λ¥
4. **Nginx ν”„λ΅μ‹**: ν΄λΌμ΄μ–ΈνΈλ¥Ό μ •μ  νμΌλ΅ μ„λΉ™

### κ°μ„ λ κΈ°λ¥λ“¤:
1. **μ „μ†΅ λ°©μ‹ κ°μ„ **: `polling` β†’ `websocket` μμ„λ΅ μ—°κ²° μ‹λ„
2. **μƒμ„Έν• λ΅κΉ…**: μ—°κ²° μƒνƒμ™€ μ¤λ¥λ¥Ό μ‹¤μ‹κ°„μΌλ΅ ν™•μΈ κ°€λ¥
3. **μ¤λ¥ μ²λ¦¬**: μ—°κ²° μ‹¤ν¨ μ‹ λ…ν™•ν• μ¤λ¥ λ©”μ‹μ§€ ν‘μ‹
4. **UI μƒνƒ κ΄€λ¦¬**: μ—°κ²° μƒνƒμ— λ”°λ¥Έ λ²„νΌ λΉ„ν™μ„±ν™”
5. **μ»¤μ¤ν…€ Socket.IO μ–΄λ‘ν„°**: μ„λ²„ μΈ΅ μ—°κ²° μ„¤μ • μµμ ν™”
6. **λ™μ  μ„λ²„ URL**: ν™κ²½μ— λ”°λ¥Έ μλ™ μ„λ²„ URL μ„¤μ •

### μ—°κ²° ν™•μΈ λ°©λ²•:
1. μ„λ²„ μ‹¤ν–‰ ν›„ μ½μ†”μ—μ„ "Socket.IO server ready for connections" λ©”μ‹μ§€ ν™•μΈ
2. ν΄λΌμ΄μ–ΈνΈμ—μ„ μƒνƒκ°€ "μ—°κ²°λ¨"μΌλ΅ λ³€κ²½λλ”μ§€ ν™•μΈ
3. λΈλΌμ°μ € κ°λ°μ λ„κµ¬ μ½μ†”μ—μ„ μ—°κ²° λ΅κ·Έ ν™•μΈ

### λ°©ν™”λ²½ μ„¤μ • (ν•„μ”μ‹):
```bash
# Ubuntu/CentOS
sudo ufw allow 80
sudo ufw allow 3000
```bash
# λλ” iptables
sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 3000 -j ACCEPT

1. λΈλΌμ°μ €μ—μ„ λ°°ν¬λ URL μ ‘μ†
2. μƒνƒκ°€ "μ—°κ²°λ¨"μΈμ§€ ν™•μΈ
3. λ‹‰λ„¤μ„κ³Ό μ±„λ„λ… μ…λ ¥ ν›„ 'μ…μ¥' λ²„νΌ ν΄λ¦­
4. λ©”μ‹μ§€ μ…λ ¥ ν›„ Enter ν‚¤ λλ” 'λ³΄λ‚΄κΈ°' λ²„νΌμΌλ΅ λ©”μ‹μ§€ μ „μ†΅
5. μ—¬λ¬ λΈλΌμ°μ € νƒ­μ„ μ—΄μ–΄ κ°™μ€ μ±„λ„λ΅ μ…μ¥ν•λ©΄ μ‹¤μ‹κ°„ μ±„ν… κ°€λ¥

## κΈ°λ¥

- μ±„λ„(λ£Έ) κΈ°λ° μ±„ν…
- μ…μ¥/ν‡΄μ¥ μ‹μ¤ν… λ©”μ‹μ§€
- μ—°κ²° μƒνƒ ν‘μ‹ λ° Socket ID ν‘μ‹
- μλ™ μ¤ν¬λ΅¤
- μ—°κ²° μ¤λ¥ μ²λ¦¬ λ° μ¬μ—°κ²°
- μ™Έλ¶€ μ ‘κ·Ό κ°€λ¥ν• ν΄λΌμ°λ“ λ°°ν¬

## ν…μ¤νΈ λ°©λ²•

μ „μ„Έκ³„ μ–΄λ””μ„λ‚ λ°°ν¬λ URLλ΅ μ ‘μ†ν•΄μ„ μ‹¤μ‹κ°„ μ±„ν…μ„ ν…μ¤νΈν•΄λ³΄μ„Έμ”!

## μ£Όμ” νμΌ

### μ„λ²„
- `src/main.ts`: μ• ν”λ¦¬μΌ€μ΄μ… μ§„μ…μ , λ™μ  ν¬νΈ μ„¤μ •
- `src/chat.gateway.ts`: Socket.IO κ²μ΄νΈμ›¨μ΄, μ±„ν… λ΅μ§
- `src/socket-io.adapter.ts`: μ»¤μ¤ν…€ Socket.IO μ–΄λ‘ν„°
- `src/app.module.ts`: μ• ν”λ¦¬μΌ€μ΄μ… λ¨λ“
- `Dockerfile`: μ„λ²„ Docker μ΄λ―Έμ§€ μ„¤μ •

### ν΄λΌμ΄μ–ΈνΈ  
- `src/App.tsx`: React λ©”μΈ μ»΄ν¬λ„νΈ, λ™μ  μ„λ²„ URL μ„¤μ •
- `src/main.tsx`: React μ• ν”λ¦¬μΌ€μ΄μ… μ§„μ…μ 
- `src/vite-env.d.ts`: ν™κ²½ λ³€μ νƒ€μ… μ •μ
- `Dockerfile`: ν΄λΌμ΄μ–ΈνΈ Docker μ΄λ―Έμ§€ μ„¤μ •
- `nginx.conf`: Nginx μ›Ήμ„λ²„ μ„¤μ •

1. λΈλΌμ°μ €μ—μ„ μ„λ²„IP λλ” http://localhost μ ‘μ† (Docker λ°°ν¬ μ‹)
- `docker-compose.yml`: λ΅μ»¬ Docker μ»¨ν…μ΄λ„ μ¤μΌ€μ¤νΈλ μ΄μ…
- `render.yaml`: Render ν΄λΌμ°λ“ λ°°ν¬ μ„¤μ •
- `Procfile`: Railway/Heroku λ°°ν¬ μ„¤μ •
- `vercel.json`: Vercel λ°°ν¬ μ„¤μ • (WebSocket μ ν•μ )

## νΈλ¬λΈ”μν…

### ν΄λΌμ°λ“ λ°°ν¬ κ΄€λ ¨
- ν™κ²½ λ³€μ μ„¤μ • ν™•μΈ: `VITE_SERVER_URL`, `PORT`
- λΉλ“ λ΅κ·Έ ν™•μΈ: κ° ν”λ«νΌμ λ°°ν¬ λ΅κ·Έ κ²€ν† 
- HTTPS μ—°κ²°: ν΄λΌμ°λ“μ—μ„λ” μλ™μΌλ΅ HTTPSκ°€ μ μ©λ¨

### Docker λ°°ν¬ κ΄€λ ¨
- ν¬νΈκ°€ μ΄λ―Έ μ‚¬μ© μ¤‘μΈ κ²½μ°: `sudo netstat -tulpn | grep :80`
- Docker μ»¨ν…μ΄λ„λ΅ λ°°ν¬ κ°€λ¥
- μ»¨ν…μ΄λ„ λ΅κ·Έ ν™•μΈ: `docker-compose logs -f [service_name]`

### WebSocket μ—°κ²° μ‹¤ν¨
λΈλΌμ°μ € νƒ­μ„ 2~3κ° μ—΄κ³  κ°™μ€ μ±„λ„λ…μΌλ΅ μ…μ¥ν•μ—¬ λ©”μ‹μ§€λ¥Ό μ£Όκ³ λ°›μ•„ λ³΄μ„Έμ”!
- ν¬νΈ 3000μ΄ λ‹¤λ¥Έ ν”„λ΅μ„Έμ¤μ—μ„ μ‚¬μ© μ¤‘μΈμ§€ ν™•μΈ: `lsof -i :3000`
- λΈλΌμ°μ € κ°λ°μ λ„κµ¬ Network νƒ­μ—μ„ Socket.IO μ”μ²­ ν™•μΈ

### CORS μ—λ¬
- `src/main.ts`: μ• ν”λ¦¬μΌ€μ΄μ… μ§„μ…μ , CORS μ„¤μ •
- ν΄λΌμ°λ“ ν™κ²½μ—μ„λ” μλ™μΌλ΅ μ¬λ°”λ¥Έ URLμ΄ μ„¤μ •λ¨

### μ—°κ²°μ€ λλ”λ° μ΄λ²¤νΈκ°€ μ• μ΄
- μ΄λ²¤νΈ μ΄λ¦„κ³Ό νμ΄λ΅λ“ ν‚¤ ν™•μΈ
- `socket.off` λ„λ½ μ—¬λ¶€ μ κ²€
- μ„λ²„ μ½μ†”μ—μ„ join/chat μ΄λ²¤νΈ λ΅κ·Έ ν™•μΈ
- `src/App.tsx`: React λ©”μΈ μ»΄ν¬λ„νΈ, Socket.IO ν΄λΌμ΄μ–ΈνΈ
### λ°© λΈλ΅λ“μΊμ¤νΈκ°€ μ• λ¨
- κ°™μ€ room μ΄λ¦„μΌλ΅ μ…μ¥ν–λ”μ§€ ν™•μΈ
